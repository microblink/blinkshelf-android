
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A shelf detection library for Android">
      
      
        <meta name="author" content="Microblink">
      
      
        <link rel="canonical" href="https://microblink.github.io/blinkshelf-android/processor_arch/">
      
      
      
      <link rel="icon" href="../images/logo.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>Processor architecture considerations - BlinkShelf</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#processor-architecture-considerations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BlinkShelf" class="md-header__button md-logo" aria-label="BlinkShelf" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BlinkShelf
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Processor architecture considerations
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microblink/blinkshelf-android" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BlinkShelf
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BlinkShelf" class="md-nav__button md-logo" aria-label="BlinkShelf" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    BlinkShelf
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microblink/blinkshelf-android" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BlinkShelf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        Fundamentals
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../custom_ux/" class="md-nav__link">
        Custom UX
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        API Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Change Log
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reducing-the-final-size-of-your-app" class="md-nav__link">
    Reducing the final size of your app
  </a>
  
    <nav class="md-nav" aria-label="Reducing the final size of your app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-apk-splits" class="md-nav__link">
    Using APK splits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-processor-architecture-support" class="md-nav__link">
    Removing processor architecture support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consequences-of-removing-processor-architecture" class="md-nav__link">
    Consequences of removing processor architecture
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="processor-architecture-considerations">Processor architecture considerations<a class="headerlink" href="#processor-architecture-considerations" title="Permanent link">&para;</a></h1>
<p>BlinkShelf is distributed with <strong>ARMv7</strong> and <strong>ARM64</strong> native library binaries.</p>
<p><strong>ARMv7</strong> architecture gives the ability to take advantage of hardware accelerated floating point operations and SIMD processing with <a href="http://www.arm.com/products/processors/technologies/neon.php">NEON</a>. This gives BlinkShelf a huge performance boost on devices that have ARMv7 processors. Most new devices (all since 2012.) have ARMv7 processor so it makes little sense not to take advantage of performance boosts that those processors can give. Also note that some devices with ARMv7 processors do not support NEON and VFPv4 instruction sets, most popular being those based on <a href="https://en.wikipedia.org/wiki/Tegra#Tegra_2">NVIDIA Tegra 2</a>, <a href="https://en.wikipedia.org/wiki/ARM_Cortex-A9">ARM Cortex A9</a> and older. Since these devices are old by today&rsquo;s standard, BlinkShelf does not support them. For the same reason, BlinkShelf does not support devices with ARMv5 (<code>armeabi</code>) architecture.</p>
<p><strong>ARM64</strong> is the new processor architecture that most new devices use. ARM64 processors are very powerful and also have the possibility to take advantage of new NEON64 SIMD instruction set to quickly process multiple pixels with a single instruction.</p>
<p>There are some issues to be considered:</p>
<ul>
<li>ARMv7 build of the native library cannot be run on devices that do not have ARMv7 compatible processor</li>
<li>ARMv7 processors do not understand x86 instruction set</li>
<li>ARM64 processors understand ARMv7 instruction set, but ARMv7 processors do not understand ARM64 instructions.<ul>
<li><a name="64bitNotice"></a> <strong>NOTE:</strong> as of the year 2018, some android devices that ship with ARM64 processors do not have full compatibility with ARMv7. This is mostly due to incorrect configuration of Android&rsquo;s 32-bit subsystem by the vendor, however Google decided that as of August 2019 all apps on PlayStore that contain native code need to have native support for 64-bit processors (this includes ARM64 and x86_64) - this is in anticipation of future Android devices that will support 64-bit code <strong>only</strong>, i.e. that will have ARM64 processors that do not understand ARMv7 instruction set.</li>
</ul>
</li>
<li>if ARM64 processor executes ARMv7 code, it does not take advantage of modern NEON64 SIMD operations and does not take advantage of 64-bit registers it has - it runs in emulation mode</li>
</ul>
<p><code>LibBlinkShelfCore.aar</code> and <code>LibBlinkShelfCameraUi.aar</code> archives contain ARMv7 and ARM64 builds of the native library. By default, when you integrate BlinkShelf into your app, your app will contain native builds for all these processor architectures. Thus, BlinkShelf will work on ARMv7 and ARM64 devices and will use ARMv7 features on ARMv7 devices and ARM64 features on ARM64 devices. However, the size of your application will be rather large.</p>
<h2 id="reducing-the-final-size-of-your-app">Reducing the final size of your app<a class="headerlink" href="#reducing-the-final-size-of-your-app" title="Permanent link">&para;</a></h2>
<p>We recommend that you distribute your app using <a href="https://developer.android.com/platform/technology/app-bundle">App Bundle</a>. This will defer apk generation to Google Play, allowing it to generate minimal APK for each specific device that downloads your app, including only required processor architecture support.</p>
<h3 id="using-apk-splits">Using APK splits<a class="headerlink" href="#using-apk-splits" title="Permanent link">&para;</a></h3>
<p>If you are unable to use App Bundle, you can create multiple flavors of your app - one flavor for each architecture. With gradle and Android studio this is very easy - just add the following code to <code>build.gradle</code> file of your app:</p>
<div class="highlight"><pre><span></span><code>android {
  ...
  splits {
    abi {
      enable true
      reset()
      include &#39;armeabi-v7a&#39;, &#39;arm64-v8a&#39;
      universalApk true
    }
  }
}
</code></pre></div>
<p>With that build instructions, gradle will build two different APK files for your app. Each APK will contain only native library for one processor architecture and one APK will contain all architectures. In order for Google Play to accept multiple APKs of the same app, you need to ensure that each APK has different version code. This can easily be done by defining a version code prefix that is dependent on architecture and adding real version code number to it in following gradle script:</p>
<div class="highlight"><pre><span></span><code>// map for the version code
def abiVersionCodes = [&#39;armeabi-v7a&#39;:1, &#39;arm64-v8a&#39;:2]

import com.android.build.OutputFile

android.applicationVariants.all { variant -&gt;
    // assign different version code for each output
    variant.outputs.each { output -&gt;
        def filter = output.getFilter(OutputFile.ABI)
        if(filter != null) {
            output.versionCodeOverride = abiVersionCodes.get(output.getFilter(OutputFile.ABI)) * 1000000 + android.defaultConfig.versionCode
        }
    }
}
</code></pre></div>
<p>For more information about creating APK splits with gradle, check <a href="https://developer.android.com/studio/build/configure-apk-splits.html#configure-abi-split">this article from Google</a>.</p>
<p>After generating multiple APK&rsquo;s, you need to upload them to Google Play. For tutorial and rules about uploading multiple APK&rsquo;s to Google Play, please read the <a href="https://developer.android.com/google/play/publishing/multiple-apks.html">official Google article about multiple APKs</a>.</p>
<h3 id="removing-processor-architecture-support">Removing processor architecture support<a class="headerlink" href="#removing-processor-architecture-support" title="Permanent link">&para;</a></h3>
<p>If you won&rsquo;t be distributing your app via Google Play or for some other reasons want to have single APK of smaller size, you can completely remove support for certain CPU architecture from your APK. <strong>This is not recommended due to <a href="#consequences-of-removing-processor-architecture">consequences</a></strong>.</p>
<p>To keep only some CPU architectures, for example <code>armeabi-v7a</code> and <code>arm64-v8a</code>, add the following statement to your <code>android</code> block inside <code>build.gradle</code>:</p>
<div class="highlight"><pre><span></span><code>android {
    ...
    ndk {
        // Tells Gradle to package the following ABIs into your application
        abiFilters &#39;armeabi-v7a&#39;, &#39;arm64-v8a&#39;
    }
}
</code></pre></div>
<p>This will remove other architecture builds for <strong>all</strong> native libraries used by the application.</p>
<p>To remove support for a certain CPU architecture only for BlinkShelf, add the following statement to your <code>android</code> block inside <code>build.gradle</code>:</p>
<div class="highlight"><pre><span></span><code>android {
    ...
    packagingOptions {
        exclude &#39;lib/&lt;ABI&gt;/libBlinkShelfCore.so&#39;
        exclude &#39;lib/&lt;ABI&gt;/libBlinkShelfCameraUi.so&#39;
    }
}
</code></pre></div>
<p>where <code>&lt;ABI&gt;</code> represents the CPU architecture you want to remove:</p>
<ul>
<li>to remove ARMv7 support, use <code>armeabi-v7a</code></li>
<li>to remove ARM64 support, use <code>arm64-v8a</code>.</li>
</ul>
<p>You can also remove multiple processor architectures by specifying <code>exclude</code> directive multiple times. Just bear in mind that removing processor architecture will have side effects on performance and stability of your app. Please read <a href="#consequences-of-removing-processor-architecture">this</a> for more information.</p>
<h3 id="consequences-of-removing-processor-architecture">Consequences of removing processor architecture<a class="headerlink" href="#consequences-of-removing-processor-architecture" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Google decided that as of August 2019 all apps on Google Play that contain native code need to have native support for 64-bit processors (this includes ARM64 and x86_64). This means that you cannot upload application to Google Play Console that supports only 32-bit ABI and does not support corresponding 64-bit ABI.</p>
</li>
<li>
<p>By removing ARMv7 support, BlinkShelf will not work on devices that have ARMv7 processors.</p>
</li>
<li>By removing ARM64 support, BlinkShelf will not use ARM64 features on ARM64 device</li>
<li>also, some future devices may ship with ARM64 processors that will not support ARMv7 instruction set.</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>